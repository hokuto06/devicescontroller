<!-- Incluye jQuery (asegúrate de agregarlo en tu proyecto) -->
{% extends "base.html" %}
    {% load static %}
    {% block content %}
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>


<div id="device-detail-container">
    <h3 class="breadcrumb-item active">Detalle del Dispositivo</h3>
    <!-- <p id="device-detail-content">Cargando...</p> -->
</div>
<div class="card mb-4">
    <div class="card-body">
        <button id="updateButton">Actualizar Dispositivo</button>
        <a href="{% url  'update_device' device.id  %}">Actualizar</a>
    </div>
</div>
<div class="container-fluid px-4">
<div class="card mb-4">
    <div class="card-header">
        <i class="fas fa-table me-1"></i>
        {{ device.deviceName }}
    </div>    
    <div class="card-body">
        <div id="device-detail-container">
        <table>
            <tr><td>Mac: {{ device.mac_address }}</td></tr>
            <tr><td>Ip: {{ device.ip_address }}</td></tr>
            <tr><td>Version: {{ device.version }}</td></tr>
            <tr><td>Controller: {{ device.controller_status }}</td></tr>
        </table>
        <!-- <p id="device-detail-content">Cargando...</p> -->
        {% if device.clientes %}
        <form id="myForm" method="post" action="{% url 'procesar_formulario' device.ip_address %}">
            {% csrf_token %}        
        <table>
            <thead>
                <tr>
                    <th>Address</th>
                    <th>Mac</th>
                    <th>Server</th>
                    <th>
                        <input type="checkbox" id="seleccionarTodos">
                    </th>
                </tr>
                <tbody>
            {% for cliente in device.clientes %}
                <tr>
                    <td>{{ cliente.address }}</td>
                    <td>{{ cliente.mac }}</td>
                    <td>{{ cliente.server }}</td>
                    <td>
                        <input type="checkbox" class="checkbox" name="clientes_seleccionados" value="{{ cliente.id }}">
                    </td>                    
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <button type="button" id="enviar" disabled>Enviar</button>
    </form>        
    {% else %}
        <p>No hay clientes disponibles.</p>
    {% endif %}
    
    </div>
</div>
</div>
<script>
    // Obtener el checkbox "Seleccionar Todos"
    const seleccionarTodosCheckbox = document.getElementById('seleccionarTodos');
    // Obtener todos los checkboxes individuales
    const checkboxes = document.querySelectorAll('.checkbox');
    // Obtener el botón de enviar
    const enviarButton = document.getElementById('enviar');

    // Agregar un evento de cambio al checkbox "Seleccionar Todos"
    seleccionarTodosCheckbox.addEventListener('change', function() {
        // Iterar sobre todos los checkboxes y establecer su estado según el estado del checkbox "Seleccionar Todos"
        checkboxes.forEach(checkbox => {
            checkbox.checked = seleccionarTodosCheckbox.checked;
        });
        // Verificar si al menos un checkbox está seleccionado
        const algunSeleccionado = [...checkboxes].some(checkbox => checkbox.checked);
        // Habilitar o deshabilitar el botón de enviar dependiendo del estado de los checkboxes
        enviarButton.disabled = !algunSeleccionado;
    });

    // Agregar un evento de clic al botón de enviar
    enviarButton.addEventListener('click', function() {
        // Obtener los IDs de los clientes seleccionados
        const clientesSeleccionados = [...checkboxes].filter(checkbox => checkbox.checked).map(checkbox => checkbox.value);
        // Hacer algo con los IDs seleccionados, por ejemplo, enviarlos a la URL de Django
        console.log(clientesSeleccionados);
        // Aquí puedes hacer una petición AJAX o enviar los IDs al backend de Django
    });

    // Iterar sobre todos los checkboxes individuales y agregar un listener para cambiar
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', () => {
            // Verificar si al menos un checkbox está seleccionado
            const algunSeleccionado = [...checkboxes].some(checkbox => checkbox.checked);
            // Habilitar o deshabilitar el botón de enviar dependiendo del estado de los checkboxes
            enviarButton.disabled = !algunSeleccionado;
        });
    });
</script>
{% endblock %}